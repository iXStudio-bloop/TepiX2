<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TapiX 2</title>
  <style>
    html, body {
      margin: 0;
      height: 100%;
      font-family: Arial, sans-serif;
      background: #1e1e1e;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    .score-box {
      position: absolute;
      top: 20px;
      padding: 15px 30px;
      background: #333;
      border-radius: 12px;
      font-size: 22px;
      font-weight: bold;
      box-shadow: 0 4px 10px rgba(0,0,0,0.4);
    }
    .click-btn {
      padding: 40px 80px;
      font-size: 26px;
      font-weight: bold;
      border: none;
      border-radius: 16px;
      background: #ff4d4d;
      color: #fff;
      cursor: pointer;
      box-shadow: 0 6px 15px rgba(255,77,77,0.6);
      transition: transform 0.1s;
    }
    .click-btn:active { transform: scale(0.95); background: #ff1a1a; }
    .settings-btn, .menu-btn {
      position: absolute;
      top: 20px;
      font-size: 24px;
      background: none;
      border: none;
      color: #fff;
      cursor: pointer;
    }
    .settings-btn { right: 20px; }
    .menu-btn { left: 20px; }

    .modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #2c2c2c;
      padding: 20px;
      border-radius: 12px;
      display: none;
      flex-direction: column;
      gap: 10px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.5);
      text-align: center;
      max-width: 90%;
    }
    .modal label, .modal p { font-size: 18px; }
    .close-btn {
      margin-top: 15px;
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      background: #ff4d4d;
      color: #fff;
      cursor: pointer;
    }
    .version { margin-top: 15px; font-size: 14px; color: #aaa; }
    .menu-list button {
      padding: 10px;
      border: none;
      border-radius: 8px;
      background: #444;
      color: #fff;
      cursor: pointer;
      margin: 5px 0;
    }
    .menu-list button:hover { background: #666; }
    input#promoInput {
      padding: 8px;
      border-radius: 8px;
      border: none;
      width: 80%;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <div class="score-box">–û—á–∫–∏: <span id="score">0</span></div>
  <button class="click-btn" onclick="addPoint()">–ö–ª–∏–∫</button>

  <button class="settings-btn" onclick="toggleSettings()">‚öôÔ∏è</button>
  <button class="menu-btn" onclick="toggleMenu()">‚ãÆ</button>

  <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
  <div class="modal" id="settings">
    <label>
      <input type="checkbox" id="music-toggle" checked>
      üéµ –ú—É–∑—ã–∫–∞
    </label>
    <button class="close-btn" onclick="toggleSettings()">–ó–∞–∫—Ä—ã—Ç—å</button>
    <div class="version">V beta 0.0.0</div>
  </div>

  <!-- –ú–µ–Ω—é -->
  <div class="modal" id="menu">
    <div class="menu-list">
      <button onclick="openProfile()">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
      <button onclick="openPromo()">üéÅ –ü—Ä–æ–º–æ–∫–æ–¥—ã</button>
      <button onclick="window.open('https://t.me/TapiX2Channel','_blank')">üì¢ –ö–∞–Ω–∞–ª</button>
      <button onclick="confirmReset()">‚ôªÔ∏è –°–±—Ä–æ—Å–∏—Ç—å –æ—á–∫–∏</button>
    </div>
    <button class="close-btn" onclick="toggleMenu()">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div><!-- –ü—Ä–æ—Ñ–∏–ª—å -->
  <div class="modal" id="profile">
    <h3>üë§ –ü—Ä–æ—Ñ–∏–ª—å</h3>
    <p id="achievements">–î–æ—Å—Ç–∏–∂–µ–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç.</p>
    <button class="close-btn" onclick="closeModal('profile')">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>

  <!-- –ü—Ä–æ–º–æ–∫–æ–¥—ã -->
  <div class="modal" id="promo">
    <h3>üéÅ –í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥</h3>
    <input type="text" id="promoInput" placeholder="–í–∞—à –∫–æ–¥">
    <button onclick="checkPromo()">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
    <p id="promoResult"></p>
    <button class="close-btn" onclick="closeModal('promo')">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π -->
  <div class="modal" id="messageModal">
    <p id="messageText"></p>
    <button class="close-btn" onclick="closeModal('messageModal')">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>

  <!-- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–±—Ä–æ—Å–∞ -->
  <div class="modal" id="confirmModal">
    <p>–í—ã —Ç–æ—á–Ω–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –æ—á–∫–∏?</p>
    <button onclick="resetScore()">–î–∞</button>
    <button onclick="closeModal('confirmModal')">–ù–µ—Ç</button>
  </div>

  <!-- –ú—É–∑—ã–∫–∞ -->
  <audio id="bg-music" loop>
    <source src="clickmusic.mp3" type="audio/mpeg">
  </audio>

  <script>
    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏–∑ localStorage
    let score = parseInt(localStorage.getItem("tapiX2Score") || "0");
    let unlocked = JSON.parse(localStorage.getItem("tapiX2Achievements") || "[]");
    document.getElementById("score").textContent = score;

    let music = document.getElementById("bg-music");
    let toggle = document.getElementById("music-toggle");
    let musicStarted = false;

    const achievements = [100, 500, 1000];

    const promoCodes = {
      "REDTAP": 150,
      "MEGACLICK": 500,
      "SECRET777": 777,
      "BOOST1000": 1000,
      "TAPSTAR": 300
    };

    // –§—É–Ω–∫—Ü–∏—è –∫–ª–∏–∫–∞
    function addPoint() {
      score++;
      document.getElementById("score").textContent = score;
      localStorage.setItem("tapiX2Score", score);

      if (!musicStarted && toggle.checked) {
        music.play().catch(() => {}); 
        musicStarted = true;
      }

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
      achievements.forEach(a => {
        if (score >= a && !unlocked.includes(a)) {
          unlocked.push(a);
          localStorage.setItem("tapiX2Achievements", JSON.stringify(unlocked));
          showMessage("üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: " + a + " –∫–ª–∏–∫–æ–≤!");
        }
      });
    }

    // –û—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–æ–∫
    function toggleSettings() {
      let s = document.getElementById("settings");
      s.style.display = s.style.display === "flex" ? "none" : "flex";
    }

    function toggleMenu() {
      let m = document.getElementById("menu");
      m.style.display = m.style.display === "flex" ? "none" : "flex";
    }

    toggle.addEventListener("change", () => {
      if (toggle.checked) {
        music.play().catch(() => {});
        musicStarted = true;
      } else {
        music.pause();
      }
    });

    function openProfile() {
      document.getElementById("menu").style.display = "none";
      let text = unlocked.length > 0 ? "–í–∞—à–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:<br>" + unlocked.join(", ") : "–î–æ—Å—Ç–∏–∂–µ–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç.";
      document.getElementById("achievements").innerHTML = text;
      document.getElementById("profile").style.display = "flex";
    }

    function openPromo() {
      document.getElementById("menu").style.display = "none";
      document.getElementById("promo").style.display = "flex";
    }

    function checkPromo() {
      let code = document.getElementById("promoInput").value.trim().toUpperCase();
      if (promoCodes[code]) {
        score += promoCodes[code];
        document.getElementById("score").textContent = score;
        localStorage.setItem("tapiX2Score", score);
        showMessage("‚úÖ –ö–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! +" + promoCodes[code] + " –æ—á–∫–æ–≤.");
      } else {
        showMessage("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥.");
      }
      document.getElementById("promoInput").value = "";
    }

    function showMessage(text) {
      document.getElementById("messageText").textContent = text;
      document.getElementById("messageModal").style.display = "flex";
    }

    function closeModal(id) {
      document.getElementById(id).style.display = "none";
    }

    function confirmReset() {
      document.getElementById("menu").style.display = "none";
      document.getElementById("confirmModal").style.display = "flex";
    }

    function resetScore() {
      score = 0;
      unlocked = [];
      localStorage.setItem("tapiX2Score", score);
      localStorage.setItem("tapiX2Achievements", JSON.stringify(unlocked));
      document.getElementById("score").textContent = score;
      closeModal('confirmModal');
      showMessage("‚ôªÔ∏è –í—Å–µ –æ—á–∫–∏ —Å–±—Ä–æ—à–µ–Ω—ã!");
    }
  </script>
</body>
</html>